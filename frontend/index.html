<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           NEO-BRUTALISM DESIGN SYSTEM
           ======================================== */
        
        :root {
            --black: #000000;
            --white: #ffffff;
            --yellow: #FFE600;
            --pink: #FF6B9D;
            --blue: #00D4FF;
            --green: #7CFF6B;
            --purple: #B794F6;
            --orange: #FF9F43;
            --red: #FF6B6B;
            --cream: #FFF8E7;
            
            --shadow: 4px 4px 0px var(--black);
            --shadow-lg: 8px 8px 0px var(--black);
            --border: 3px solid var(--black);
            --border-thick: 5px solid var(--black);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--cream);
            background-image: 
                radial-gradient(circle, #ddd 1px, transparent 1px);
            background-size: 24px 24px;
            min-height: 100vh;
            padding: 20px;
        }

        /* ========================================
           HEADER
           ======================================== */
        .header {
            background: var(--yellow);
            border: var(--border-thick);
            box-shadow: var(--shadow-lg);
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Space Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-box {
            background: var(--black);
            color: var(--yellow);
            padding: 5px 12px;
            transform: rotate(-2deg);
        }

        .header-badge {
            background: var(--pink);
            border: var(--border);
            padding: 8px 16px;
            font-weight: 700;
            font-size: 14px;
            transform: rotate(2deg);
        }

        /* ========================================
           NAVIGATION TABS
           ======================================== */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            background: var(--white);
            border: var(--border);
            border-right: none;
            padding: 18px 28px;
            font-size: 15px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.1s;
            font-family: 'Space Mono', monospace;
        }

        .tab:last-child {
            border-right: var(--border);
        }

        .tab:hover {
            background: var(--purple);
            transform: translateY(-3px);
        }

        .tab.active {
            background: var(--blue);
            box-shadow: var(--shadow);
            transform: translate(-3px, -3px);
            z-index: 10;
            position: relative;
        }

        /* ========================================
           MAIN GRID
           ======================================== */
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* ========================================
           CARDS
           ======================================== */
        .card {
            background: var(--white);
            border: var(--border-thick);
            box-shadow: var(--shadow-lg);
            padding: 0;
            overflow: hidden;
        }

        .card-header {
            background: var(--black);
            color: var(--white);
            padding: 18px 25px;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            font-family: 'Space Mono', monospace;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-header.pink { background: var(--pink); color: var(--black); }
        .card-header.blue { background: var(--blue); color: var(--black); }
        .card-header.green { background: var(--green); color: var(--black); }
        .card-header.yellow { background: var(--yellow); color: var(--black); }
        .card-header.purple { background: var(--purple); color: var(--black); }
        .card-header.orange { background: var(--orange); color: var(--black); }

        .card-body {
            padding: 25px;
        }

        /* ========================================
           BUTTONS
           ======================================== */
        .btn {
            background: var(--yellow);
            border: var(--border);
            box-shadow: var(--shadow);
            padding: 14px 28px;
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.1s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translate(-3px, -3px);
            box-shadow: 7px 7px 0px var(--black);
        }

        .btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--black);
        }

        .btn-pink { background: var(--pink); }
        .btn-blue { background: var(--blue); }
        .btn-green { background: var(--green); }
        .btn-purple { background: var(--purple); }
        .btn-orange { background: var(--orange); }
        .btn-black { background: var(--black); color: var(--white); }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: var(--shadow) !important;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* ========================================
           INPUTS
           ======================================== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 12px;
            margin-bottom: 10px;
            font-family: 'Space Mono', monospace;
            letter-spacing: 0.5px;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 14px 18px;
            border: var(--border);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 15px;
            background: var(--white);
            transition: all 0.1s;
        }

        textarea {
            min-height: 140px;
            resize: vertical;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            box-shadow: var(--shadow);
            transform: translate(-2px, -2px);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 45px;
        }

        /* ========================================
           FILE UPLOAD
           ======================================== */
        .file-upload {
            border: 5px dashed var(--black);
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(0,0,0,0.02) 10px,
                rgba(0,0,0,0.02) 20px
            );
        }

        .file-upload:hover {
            background: var(--yellow);
            border-style: solid;
        }

        .file-upload-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .file-upload-text {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .file-upload-hint {
            font-size: 13px;
            color: #666;
        }

        .file-upload input {
            display: none;
        }

        /* ========================================
           OUTPUT BOX
           ======================================== */
        .output {
            background: var(--cream);
            border: var(--border);
            padding: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 15px;
            line-height: 1.7;
        }

        .output:empty::before {
            content: "‚ú® K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...";
            color: #999;
            font-style: italic;
        }

        /* ========================================
           FLASHCARD
           ======================================== */
        .flashcard-container {
            perspective: 1000px;
        }

        .flashcard {
            background: var(--white);
            border: var(--border-thick);
            box-shadow: var(--shadow-lg);
            padding: 40px 30px;
            text-align: center;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .flashcard:hover {
            transform: rotate(-1deg) scale(1.02);
        }

        .flashcard.flipped {
            background: var(--green);
        }

        .flashcard-badge {
            position: absolute;
            top: -15px;
            left: 25px;
            background: var(--pink);
            border: var(--border);
            padding: 6px 18px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            font-family: 'Space Mono', monospace;
        }

        .flashcard.flipped .flashcard-badge {
            background: var(--blue);
        }

        .flashcard-content {
            font-size: 20px;
            font-weight: 500;
            line-height: 1.5;
        }

        .flashcard-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 25px;
        }

        .flashcard-counter {
            background: var(--black);
            color: var(--white);
            padding: 12px 20px;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
        }

        /* ========================================
           QUIZ
           ======================================== */
        .quiz-question {
            background: var(--purple);
            border: var(--border-thick);
            padding: 20px 25px;
            margin-bottom: 20px;
            font-size: 17px;
            font-weight: 600;
        }

        .quiz-question-number {
            background: var(--black);
            color: var(--white);
            padding: 4px 12px;
            font-size: 13px;
            font-weight: 700;
            margin-right: 12px;
            font-family: 'Space Mono', monospace;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quiz-option {
            background: var(--white);
            border: var(--border);
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quiz-option:hover {
            background: var(--yellow);
            transform: translateX(8px);
        }

        .quiz-option.selected {
            background: var(--blue);
            box-shadow: var(--shadow);
            transform: translateX(5px);
        }

        .quiz-option.correct {
            background: var(--green) !important;
        }

        .quiz-option.wrong {
            background: var(--red) !important;
        }

        .quiz-option-letter {
            background: var(--black);
            color: var(--white);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-family: 'Space Mono', monospace;
            flex-shrink: 0;
        }

        .quiz-result {
            background: var(--green);
            border: var(--border-thick);
            padding: 30px;
            text-align: center;
            margin-top: 25px;
        }

        .quiz-score {
            font-size: 48px;
            font-weight: 900;
            font-family: 'Space Mono', monospace;
        }

        /* ========================================
           CHAT
           ======================================== */
        .chat-messages {
            background: var(--cream);
            border: var(--border);
            padding: 20px;
            min-height: 350px;
            max-height: 450px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .chat-message {
            margin-bottom: 18px;
            display: flex;
            gap: 12px;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 45px;
            height: 45px;
            border: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .chat-message.user .chat-avatar {
            background: var(--blue);
        }

        .chat-message.bot .chat-avatar {
            background: var(--pink);
        }

        .chat-bubble {
            background: var(--white);
            border: var(--border);
            padding: 14px 18px;
            max-width: 75%;
            box-shadow: 3px 3px 0px var(--black);
            line-height: 1.6;
        }

        .chat-message.user .chat-bubble {
            background: var(--blue);
        }

        .chat-input-row {
            display: flex;
            gap: 12px;
        }

        .chat-input-row input {
            flex: 1;
        }

        /* ========================================
           DOCUMENT LIST
           ======================================== */
        .doc-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .doc-item {
            background: var(--white);
            border: var(--border);
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.1s;
        }

        .doc-item:hover {
            background: var(--yellow);
            transform: translateX(8px);
        }

        .doc-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .doc-icon {
            font-size: 28px;
        }

        .doc-name {
            font-weight: 700;
            font-size: 16px;
        }

        .doc-date {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        .doc-actions {
            display: flex;
            gap: 8px;
        }

        .doc-actions .btn {
            padding: 10px 14px;
            font-size: 16px;
        }

        /* ========================================
           STATS BAR
           ======================================== */
        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: var(--white);
            border: var(--border);
            box-shadow: var(--shadow);
            padding: 18px 28px;
            display: flex;
            align-items: center;
            gap: 18px;
            flex: 1;
            min-width: 180px;
        }

        .stat-icon {
            font-size: 32px;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 900;
            font-family: 'Space Mono', monospace;
            line-height: 1;
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 700;
            color: #666;
        }

        .stat-box.yellow { border-left: 8px solid var(--yellow); }
        .stat-box.pink { border-left: 8px solid var(--pink); }
        .stat-box.blue { border-left: 8px solid var(--blue); }
        .stat-box.green { border-left: 8px solid var(--green); }

        /* ========================================
           LOADING SPINNER
           ======================================== */
        .spinner {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 4px solid var(--black);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========================================
           TOAST
           ======================================== */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--black);
            color: var(--white);
            border: var(--border);
            padding: 18px 28px;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
            transform: translateY(120px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 9999;
            font-family: 'Space Mono', monospace;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success { background: var(--green); color: var(--black); }
        .toast.error { background: var(--red); color: var(--black); }

        /* ========================================
           SECTIONS
           ======================================== */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* ========================================
           DIVIDER
           ======================================== */
        .divider {
            text-align: center;
            margin: 25px 0;
            font-weight: 700;
            font-size: 14px;
            color: #666;
        }

        .divider::before,
        .divider::after {
            content: "‚Äî‚Äî‚Äî‚Äî‚Äî";
            margin: 0 15px;
        }

        /* ========================================
           EMPTY STATE
           ======================================== */
        .empty-state {
            text-align: center;
            padding: 50px 30px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .empty-state-text {
            font-size: 16px;
        }

        /* ========================================
           AUTH MODAL
           ======================================== */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .auth-modal.hidden {
            display: none;
        }

        .auth-container {
            width: 100%;
            max-width: 420px;
            padding: 20px;
        }

        .auth-card {
            background: var(--white);
            border: var(--border-thick);
            box-shadow: var(--shadow-lg);
            padding: 40px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header .logo-box {
            display: inline-block;
            background: var(--black);
            color: var(--yellow);
            padding: 8px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .auth-header h2 {
            font-size: 24px;
            margin-top: 10px;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form h3 {
            font-size: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .auth-form small {
            display: block;
            margin-top: 5px;
            color: #888;
            font-size: 12px;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }

        .auth-switch a {
            color: var(--purple);
            font-weight: 700;
            text-decoration: none;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--white);
            border: var(--border);
            padding: 8px 15px;
        }

        .user-info span {
            font-weight: 600;
            font-size: 14px;
        }

        .btn-small {
            padding: 5px 10px !important;
            font-size: 12px !important;
        }

        .btn-red {
            background: var(--red);
        }

        .btn-red:hover {
            background: #ff5252;
        }
    </style>
</head>
<body>
    <!-- AUTH MODAL -->
    <div id="authModal" class="auth-modal">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <span class="logo-box">AI</span>
                    <h2>Study Assistant</h2>
                </div>
                
                <!-- Login Form -->
                <div id="loginForm" class="auth-form active">
                    <h3>üîê ƒêƒÉng nh·∫≠p</h3>
                    <div class="form-group">
                        <label>üìß Email</label>
                        <input type="email" id="loginEmail" placeholder="email@example.com">
                    </div>
                    <div class="form-group">
                        <label>üîë M·∫≠t kh·∫©u</label>
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn btn-black btn-block" onclick="login()">
                        üöÄ ƒêƒÇNG NH·∫¨P
                    </button>
                    <p class="auth-switch">
                        Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="showRegister()">ƒêƒÉng k√Ω ngay</a>
                    </p>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" class="auth-form">
                    <h3>‚ú® ƒêƒÉng k√Ω</h3>
                    <div class="form-group">
                        <label>üë§ H·ªç t√™n</label>
                        <input type="text" id="registerName" placeholder="Nguy·ªÖn VƒÉn A">
                    </div>
                    <div class="form-group">
                        <label>üìß Email</label>
                        <input type="email" id="registerEmail" placeholder="email@example.com">
                    </div>
                    <div class="form-group">
                        <label>üîë M·∫≠t kh·∫©u</label>
                        <input type="password" id="registerPassword" placeholder="T·ªëi thi·ªÉu 8 k√Ω t·ª±">
                        <small>Y√™u c·∫ßu: 8+ k√Ω t·ª±, c√≥ ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë</small>
                    </div>
                    <div class="form-group">
                        <label>üîë X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                        <input type="password" id="registerConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn btn-green btn-block" onclick="register()">
                        ‚úÖ ƒêƒÇNG K√ù
                    </button>
                    <p class="auth-switch">
                        ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="showLogin()">ƒêƒÉng nh·∫≠p</a>
                    </p>
                </div>
                
                <!-- Verify Form -->
                <div id="verifyForm" class="auth-form">
                    <h3>üì¨ X√°c nh·∫≠n Email</h3>
                    <p style="margin-bottom: 20px; color: #666;">
                        M√£ x√°c nh·∫≠n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n
                    </p>
                    <div class="form-group">
                        <label>üî¢ M√£ x√°c nh·∫≠n</label>
                        <input type="text" id="verifyCode" placeholder="123456" maxlength="6">
                    </div>
                    <button class="btn btn-purple btn-block" onclick="verifyEmail()">
                        ‚úÖ X√ÅC NH·∫¨N
                    </button>
                    <p class="auth-switch">
                        <a href="#" onclick="resendCode()">G·ª≠i l·∫°i m√£</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="logo">
            <span class="logo-box">AI</span>
            Study Assistant
        </div>
        <div class="header-right">
            <div class="header-badge">
                ‚ö° Powered by Gemini
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userName">üë§ User</span>
                <button class="btn btn-small btn-red" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </header>

    <!-- STATS BAR -->
    <div class="stats-bar">
        <div class="stat-box yellow">
            <div class="stat-icon">üìö</div>
            <div>
                <div class="stat-number" id="stat-docs">0</div>
                <div class="stat-label">T√†i li·ªáu</div>
            </div>
        </div>
        <div class="stat-box pink">
            <div class="stat-icon">üé¥</div>
            <div>
                <div class="stat-number" id="stat-flashcards">0</div>
                <div class="stat-label">Flashcards</div>
            </div>
        </div>
        <div class="stat-box blue">
            <div class="stat-icon">‚ùì</div>
            <div>
                <div class="stat-number" id="stat-quizzes">0</div>
                <div class="stat-label">C√¢u Quiz</div>
            </div>
        </div>
        <div class="stat-box green">
            <div class="stat-icon">üí¨</div>
            <div>
                <div class="stat-number" id="stat-chats">0</div>
                <div class="stat-label">Tin nh·∫Øn</div>
            </div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="tabs">
        <div class="tab active" data-tab="upload">üì§ Upload</div>
        <div class="tab" data-tab="documents">üìö T√†i li·ªáu</div>
        <div class="tab" data-tab="flashcards">üé¥ Flashcards</div>
        <div class="tab" data-tab="quiz">‚ùì Quiz</div>
        <div class="tab" data-tab="chat">üí¨ Chat</div>
        <div class="tab" data-tab="explain">üßí ELI5</div>
    </nav>

    <!-- ==================== UPLOAD SECTION ==================== -->
    <section class="section active" id="section-upload">
        <div class="container">
            <div class="card">
                <div class="card-header yellow">üì§ Upload T√†i Li·ªáu</div>
                <div class="card-body">
                    <div class="file-upload" id="dropZone">
                        <div class="file-upload-icon">üìÑ</div>
                        <div class="file-upload-text">K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn</div>
                        <div class="file-upload-hint">H·ªó tr·ª£: PDF, TXT, DOCX (t·ªëi ƒëa 10MB)</div>
                        <input type="file" id="fileInput" accept=".pdf,.txt,.docx">
                    </div>

                    <div class="divider">HO·∫∂C</div>

                    <div class="form-group">
                        <label>üìù Nh·∫≠p n·ªôi dung tr·ª±c ti·∫øp</label>
                        <textarea id="directContent" placeholder="Paste n·ªôi dung t√†i li·ªáu h·ªçc t·∫≠p v√†o ƒë√¢y..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>üìå T√™n t√†i li·ªáu</label>
                        <input type="text" id="docName" placeholder="V√≠ d·ª•: B√†i gi·∫£ng Machine Learning Ch∆∞∆°ng 1">
                    </div>

                    <button class="btn btn-black btn-block" onclick="uploadDocument()">
                        üöÄ UPLOAD T√ÄI LI·ªÜU
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header pink">üìã H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</div>
                <div class="card-body">
                    <div style="line-height: 2.2; font-size: 15px;">
                        <p><strong>‚ë† Upload:</strong> T·∫£i l√™n PDF/TXT ho·∫∑c paste n·ªôi dung</p>
                        <p><strong>‚ë° Ch·ªçn t√†i li·ªáu:</strong> T·ª´ tab "T√†i li·ªáu"</p>
                        <p><strong>‚ë¢ H·ªçc t·∫≠p v·ªõi AI:</strong></p>
                        <ul style="margin-left: 25px; margin-top: 5px;">
                            <li>üé¥ <strong>Flashcards</strong> - √în t·∫≠p v·ªõi th·∫ª ghi nh·ªõ</li>
                            <li>‚ùì <strong>Quiz</strong> - Ki·ªÉm tra ki·∫øn th·ª©c</li>
                            <li>üí¨ <strong>Chat</strong> - H·ªèi ƒë√°p v·ªõi AI</li>
                            <li>üìù <strong>T√≥m t·∫Øt</strong> - R√∫t g·ªçn n·ªôi dung</li>
                            <li>üßí <strong>ELI5</strong> - Gi·∫£i th√≠ch ƒë∆°n gi·∫£n</li>
                        </ul>
                    </div>

                    <div style="margin-top: 25px; padding: 18px; background: var(--green); border: var(--border);">
                        <strong>üí° M·∫πo hay:</strong> N·ªôi dung c√†ng chi ti·∫øt, AI t·∫°o flashcards v√† quiz c√†ng ch·∫•t l∆∞·ª£ng!
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== DOCUMENTS SECTION ==================== -->
    <section class="section" id="section-documents">
        <div class="container">
            <div class="card full-width">
                <div class="card-header blue">üìö Danh S√°ch T√†i Li·ªáu</div>
                <div class="card-body">
                    <div class="doc-list" id="docList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <div class="empty-state-text">ƒêang t·∫£i danh s√°ch...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== FLASHCARDS SECTION ==================== -->
    <section class="section" id="section-flashcards">
        <div class="container">
            <div class="card">
                <div class="card-header pink">üé¥ T·∫°o Flashcards</div>
                <div class="card-body">
                    <div class="form-group">
                        <label>üìö Ch·ªçn t√†i li·ªáu</label>
                        <select id="flashcardDocSelect">
                            <option value="">-- Ch·ªçn t√†i li·ªáu --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>üî¢ S·ªë l∆∞·ª£ng flashcards</label>
                        <input type="number" id="flashcardCount" value="5" min="1" max="20">
                    </div>

                    <button class="btn btn-pink btn-block" onclick="createFlashcards()">
                        ‚ú® T·∫†O FLASHCARDS
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header green">üìñ √în T·∫≠p Flashcards</div>
                <div class="card-body">
                    <div class="flashcard-container">
                        <div class="flashcard" onclick="flipCard()" id="currentFlashcard">
                            <div class="flashcard-badge" id="flashcardBadge">C√¢u h·ªèi</div>
                            <div class="flashcard-content" id="flashcardContent">
                                üëÜ Ch·ªçn t√†i li·ªáu v√† t·∫°o flashcards ƒë·ªÉ b·∫Øt ƒë·∫ßu √¥n t·∫≠p!
                            </div>
                        </div>
                    </div>

                    <div class="flashcard-nav">
                        <button class="btn" onclick="prevCard()">‚óÄ Tr∆∞·ªõc</button>
                        <div class="flashcard-counter" id="cardCounter">0 / 0</div>
                        <button class="btn" onclick="nextCard()">Sau ‚ñ∂</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== QUIZ SECTION ==================== -->
    <section class="section" id="section-quiz">
        <div class="container">
            <div class="card">
                <div class="card-header purple">‚ùì T·∫°o Quiz</div>
                <div class="card-body">
                    <div class="form-group">
                        <label>üìö Ch·ªçn t√†i li·ªáu</label>
                        <select id="quizDocSelect">
                            <option value="">-- Ch·ªçn t√†i li·ªáu --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>üî¢ S·ªë c√¢u h·ªèi</label>
                        <input type="number" id="quizCount" value="5" min="1" max="20">
                    </div>

                    <div class="form-group">
                        <label>üìä ƒê·ªô kh√≥</label>
                        <select id="quizDifficulty">
                            <option value="easy">üü¢ D·ªÖ</option>
                            <option value="medium" selected>üü° Trung b√¨nh</option>
                            <option value="hard">üî¥ Kh√≥</option>
                        </select>
                    </div>

                    <button class="btn btn-purple btn-block" onclick="createQuiz()">
                        üéØ T·∫†O QUIZ
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header orange">üèÜ L√†m Quiz</div>
                <div class="card-body">
                    <div id="quizArea">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <div class="empty-state-text">T·∫°o quiz ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i!</div>
                        </div>
                    </div>
                    <div id="quizResult" style="display: none;"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== CHAT SECTION ==================== -->
    <section class="section" id="section-chat">
        <div class="container">
            <div class="card full-width">
                <div class="card-header blue">üí¨ Chat V·ªõi T√†i Li·ªáu</div>
                <div class="card-body">
                    <div class="form-group">
                        <label>üìö Ch·ªçn t√†i li·ªáu ƒë·ªÉ h·ªèi ƒë√°p</label>
                        <select id="chatDocSelect">
                            <option value="">-- Ch·ªçn t√†i li·ªáu --</option>
                        </select>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message bot">
                            <div class="chat-avatar">ü§ñ</div>
                            <div class="chat-bubble">
                                Xin ch√†o! H√£y ch·ªçn t√†i li·ªáu v√† ƒë·∫∑t c√¢u h·ªèi, t√¥i s·∫Ω gi√∫p b·∫°n t√¨m hi·ªÉu n·ªôi dung! üìö
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-row">
                        <input type="text" id="chatInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." onkeypress="if(event.key==='Enter')sendChat()">
                        <button class="btn btn-blue" onclick="sendChat()">üì§ G·ª¨I</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== EXPLAIN SECTION ==================== -->
    <section class="section" id="section-explain">
        <div class="container">
            <div class="card">
                <div class="card-header green">üßí Gi·∫£i Th√≠ch ƒê∆°n Gi·∫£n (ELI5)</div>
                <div class="card-body">
                    <div class="form-group">
                        <label>üî§ Kh√°i ni·ªám c·∫ßn gi·∫£i th√≠ch</label>
                        <input type="text" id="explainConcept" placeholder="V√≠ d·ª•: Machine Learning, Blockchain, API...">
                    </div>

                    <div class="form-group">
                        <label>üìä C·∫•p ƒë·ªô gi·∫£i th√≠ch</label>
                        <select id="explainLevel">
                            <option value="eli5">üßí ELI5 - Nh∆∞ gi·∫£i th√≠ch cho tr·∫ª 5 tu·ªïi</option>
                            <option value="beginner">üìó Beginner - Ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu</option>
                            <option value="intermediate">üìò Intermediate - Trung c·∫•p</option>
                            <option value="expert">üìï Expert - Chuy√™n gia</option>
                        </select>
                    </div>

                    <button class="btn btn-green btn-block" onclick="explainConcept()">
                        üí° GI·∫¢I TH√çCH NGAY
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header yellow">üìñ K·∫øt Qu·∫£ Gi·∫£i Th√≠ch</div>
                <div class="card-body">
                    <div class="output" id="explainOutput"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // ========================================
        // CONFIG
        // ========================================
        // COGNITO CONFIGURATION
        // ========================================
        const COGNITO_CONFIG = {
            UserPoolId: 'ap-southeast-1_Vw8zDmUiV',
            ClientId: '7g0840a5f1l3clqh9kjgvdc6jn',
            Region: 'ap-southeast-1'
        };

        // Auth state
        let currentUser = null;
        let authToken = null;
        let pendingEmail = null;

        // ========================================
        // AUTH FUNCTIONS
        // ========================================
        function showLogin() {
            document.getElementById('loginForm').classList.add('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('verifyForm').classList.remove('active');
        }

        function showRegister() {
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.add('active');
            document.getElementById('verifyForm').classList.remove('active');
        }

        function showVerify() {
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('verifyForm').classList.add('active');
        }

        async function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (!name || !email || !password) {
                showToast('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showToast('‚ö†Ô∏è M·∫≠t kh·∫©u kh√¥ng kh·ªõp!', 'error');
                return;
            }

            if (password.length < 8) {
                showToast('‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±!', 'error');
                return;
            }

            // Check password requirements
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);

            if (!hasUpper || !hasLower || !hasNumber) {
                showToast('‚ö†Ô∏è M·∫≠t kh·∫©u c·∫ßn c√≥ ch·ªØ hoa, ch·ªØ th∆∞·ªùng v√† s·ªë!', 'error');
                return;
            }

            try {
                showToast('‚è≥ ƒêang ƒëƒÉng k√Ω...', 'info');
                
                // Call Cognito SignUp API
                const response = await fetch(`https://cognito-idp.${COGNITO_CONFIG.Region}.amazonaws.com/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-amz-json-1.1',
                        'X-Amz-Target': 'AWSCognitoIdentityProviderService.SignUp'
                    },
                    body: JSON.stringify({
                        ClientId: COGNITO_CONFIG.ClientId,
                        Username: email,
                        Password: password,
                        UserAttributes: [
                            { Name: 'email', Value: email },
                            { Name: 'name', Value: name }
                        ]
                    })
                });

                const data = await response.json();

                if (data.__type) {
                    // Error
                    if (data.__type.includes('UsernameExistsException')) {
                        showToast('‚ùå Email ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω!', 'error');
                    } else if (data.__type.includes('InvalidPasswordException')) {
                        showToast('‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë·ªß m·∫°nh!', 'error');
                    } else {
                        showToast('‚ùå ' + (data.message || 'L·ªói ƒëƒÉng k√Ω'), 'error');
                    }
                    return;
                }

                pendingEmail = email;
                showToast('‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Ki·ªÉm tra email ƒë·ªÉ l·∫•y m√£ x√°c nh·∫≠n.', 'success');
                showVerify();

            } catch (error) {
                console.error('Register error:', error);
                showToast('‚ùå L·ªói ƒëƒÉng k√Ω: ' + error.message, 'error');
            }
        }

        async function verifyEmail() {
            const code = document.getElementById('verifyCode').value.trim();

            if (!code || !pendingEmail) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p m√£ x√°c nh·∫≠n!', 'error');
                return;
            }

            try {
                showToast('‚è≥ ƒêang x√°c nh·∫≠n...', 'info');

                const response = await fetch(`https://cognito-idp.${COGNITO_CONFIG.Region}.amazonaws.com/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-amz-json-1.1',
                        'X-Amz-Target': 'AWSCognitoIdentityProviderService.ConfirmSignUp'
                    },
                    body: JSON.stringify({
                        ClientId: COGNITO_CONFIG.ClientId,
                        Username: pendingEmail,
                        ConfirmationCode: code
                    })
                });

                const data = await response.json();

                if (data.__type) {
                    if (data.__type.includes('CodeMismatchException')) {
                        showToast('‚ùå M√£ x√°c nh·∫≠n kh√¥ng ƒë√∫ng!', 'error');
                    } else if (data.__type.includes('ExpiredCodeException')) {
                        showToast('‚ùå M√£ x√°c nh·∫≠n ƒë√£ h·∫øt h·∫°n!', 'error');
                    } else {
                        showToast('‚ùå ' + (data.message || 'L·ªói x√°c nh·∫≠n'), 'error');
                    }
                    return;
                }

                showToast('‚úÖ X√°c nh·∫≠n th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.', 'success');
                showLogin();
                document.getElementById('loginEmail').value = pendingEmail;
                pendingEmail = null;

            } catch (error) {
                console.error('Verify error:', error);
                showToast('‚ùå L·ªói x√°c nh·∫≠n: ' + error.message, 'error');
            }
        }

        async function resendCode() {
            if (!pendingEmail) {
                showToast('‚ö†Ô∏è Kh√¥ng c√≥ email ƒë·ªÉ g·ª≠i l·∫°i m√£!', 'error');
                return;
            }

            try {
                showToast('‚è≥ ƒêang g·ª≠i l·∫°i m√£...', 'info');

                const response = await fetch(`https://cognito-idp.${COGNITO_CONFIG.Region}.amazonaws.com/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-amz-json-1.1',
                        'X-Amz-Target': 'AWSCognitoIdentityProviderService.ResendConfirmationCode'
                    },
                    body: JSON.stringify({
                        ClientId: COGNITO_CONFIG.ClientId,
                        Username: pendingEmail
                    })
                });

                const data = await response.json();

                if (data.__type) {
                    showToast('‚ùå ' + (data.message || 'L·ªói g·ª≠i m√£'), 'error');
                    return;
                }

                showToast('‚úÖ ƒê√£ g·ª≠i l·∫°i m√£ x√°c nh·∫≠n!', 'success');

            } catch (error) {
                showToast('‚ùå L·ªói: ' + error.message, 'error');
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p email v√† m·∫≠t kh·∫©u!', 'error');
                return;
            }

            try {
                showToast('‚è≥ ƒêang ƒëƒÉng nh·∫≠p...', 'info');

                const response = await fetch(`https://cognito-idp.${COGNITO_CONFIG.Region}.amazonaws.com/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-amz-json-1.1',
                        'X-Amz-Target': 'AWSCognitoIdentityProviderService.InitiateAuth'
                    },
                    body: JSON.stringify({
                        AuthFlow: 'USER_PASSWORD_AUTH',
                        ClientId: COGNITO_CONFIG.ClientId,
                        AuthParameters: {
                            USERNAME: email,
                            PASSWORD: password
                        }
                    })
                });

                const data = await response.json();

                if (data.__type) {
                    if (data.__type.includes('NotAuthorizedException')) {
                        showToast('‚ùå Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!', 'error');
                    } else if (data.__type.includes('UserNotConfirmedException')) {
                        pendingEmail = email;
                        showToast('‚ö†Ô∏è T√†i kho·∫£n ch∆∞a x√°c nh·∫≠n. Vui l√≤ng ki·ªÉm tra email.', 'error');
                        showVerify();
                    } else if (data.__type.includes('UserNotFoundException')) {
                        showToast('‚ùå T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!', 'error');
                    } else {
                        showToast('‚ùå ' + (data.message || 'L·ªói ƒëƒÉng nh·∫≠p'), 'error');
                    }
                    return;
                }

                // Success - save tokens
                const tokens = data.AuthenticationResult;
                authToken = tokens.IdToken;
                
                // Decode JWT to get user info
                const payload = JSON.parse(atob(authToken.split('.')[1]));
                currentUser = {
                    email: payload.email,
                    name: payload.name || payload.email.split('@')[0],
                    sub: payload.sub
                };

                // Save to localStorage
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('refreshToken', tokens.RefreshToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                // Update UI
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('userName').textContent = 'üë§ ' + currentUser.name;

                showToast('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
                loadDocuments();

            } catch (error) {
                console.error('Login error:', error);
                showToast('‚ùå L·ªói ƒëƒÉng nh·∫≠p: ' + error.message, 'error');
            }
        }

        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('currentUser');

            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('userInfo').style.display = 'none';
            showLogin();

            showToast('üëã ƒê√£ ƒëƒÉng xu·∫•t!', 'success');
        }

        function checkAuth() {
            const savedToken = localStorage.getItem('authToken');
            const savedUser = localStorage.getItem('currentUser');

            if (savedToken && savedUser) {
                try {
                    // Check if token is expired
                    const payload = JSON.parse(atob(savedToken.split('.')[1]));
                    const exp = payload.exp * 1000;

                    if (Date.now() < exp) {
                        authToken = savedToken;
                        currentUser = JSON.parse(savedUser);

                        document.getElementById('authModal').classList.add('hidden');
                        document.getElementById('userInfo').style.display = 'flex';
                        document.getElementById('userName').textContent = 'üë§ ' + currentUser.name;
                        return true;
                    }
                } catch (e) {
                    console.error('Token check error:', e);
                }
            }

            // Not authenticated - show login modal
            document.getElementById('authModal').classList.remove('hidden');
            return false;
        }

        // ========================================
        const API_BASE = 'https://0q3mju5aqe.execute-api.ap-southeast-1.amazonaws.com/dev';
        
        let documents = [];
        let currentFlashcards = [];
        let currentFlashcardIndex = 0;
        let isFlipped = false;
        let currentQuiz = null;
        let selectedAnswers = {};
        let chatCount = 0;

        // ========================================
        // TAB NAVIGATION
        // ========================================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`section-${tab.dataset.tab}`).classList.add('active');
                
                if (tab.dataset.tab === 'documents') loadDocuments();
            });
        });

        // ========================================
        // TOAST
        // ========================================
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => toast.classList.remove('show'), 3500);
        }

        // ========================================
        // API HELPER
        // ========================================
        async function apiCall(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: { 
                    'Content-Type': 'application/json'
                }
            };
            
            // Add auth token if available
            if (authToken) {
                options.headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            if (body) options.body = JSON.stringify(body);
            
            const response = await fetch(`${API_BASE}${endpoint}`, options);
            const data = await response.json();
            
            if (!response.ok) throw new Error(data.error || 'API Error');
            return data;
        }

        // ========================================
        // UPLOAD
        // ========================================
        async function uploadDocument() {
            const content = document.getElementById('directContent').value;
            const name = document.getElementById('docName').value || 'T√†i li·ªáu ' + new Date().toLocaleDateString('vi-VN');
            
            // Check if we have a selected file (PDF/DOCX) or plain text
            if (selectedFile) {
                const ext = selectedFile.name.toLowerCase().split('.').pop();
                
                try {
                    showToast('üì§ ƒêang upload t√†i li·ªáu ' + ext.toUpperCase() + '...', 'info');
                    
                    // Read file as base64
                    const base64 = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => {
                            const base64String = reader.result.split(',')[1];
                            resolve(base64String);
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(selectedFile);
                    });
                    
                    const contentTypes = {
                        'pdf': 'application/pdf',
                        'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'doc': 'application/msword',
                        'txt': 'text/plain'
                    };
                    
                    await apiCall('/documents/upload', 'POST', {
                        file: base64,
                        fileName: selectedFile.name,
                        fileType: contentTypes[ext] || 'application/octet-stream'
                    });
                    
                    showToast('‚úÖ Upload th√†nh c√¥ng!', 'success');
                    document.getElementById('directContent').value = '';
                    document.getElementById('docName').value = '';
                    selectedFile = null;
                    loadDocuments();
                } catch (error) {
                    showToast('‚ùå L·ªói: ' + error.message, 'error');
                }
            } else if (content && !content.startsWith('üìé File ƒë√£ ch·ªçn:')) {
                // Plain text content
                try {
                    showToast('üì§ ƒêang upload t√†i li·ªáu...', 'info');
                    await apiCall('/documents/upload', 'POST', {
                        content: content,
                        filename: name + '.txt',
                        contentType: 'text/plain'
                    });
                    
                    showToast('‚úÖ Upload th√†nh c√¥ng!', 'success');
                    document.getElementById('directContent').value = '';
                    document.getElementById('docName').value = '';
                    loadDocuments();
                } catch (error) {
                    showToast('‚ùå L·ªói: ' + error.message, 'error');
                }
            } else {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p n·ªôi dung ho·∫∑c ch·ªçn file!', 'error');
            }
        }

        // ========================================
        // LOAD DOCUMENTS
        // ========================================
        async function loadDocuments() {
            try {
                const result = await apiCall('/documents');
                documents = result.documents || [];
                
                const docList = document.getElementById('docList');
                if (documents.length === 0) {
                    docList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <div class="empty-state-text">Ch∆∞a c√≥ t√†i li·ªáu n√†o.<br>H√£y upload t√†i li·ªáu ƒë·∫ßu ti√™n!</div>
                        </div>
                    `;
                } else {
                    docList.innerHTML = documents.map(doc => `
                        <div class="doc-item">
                            <div class="doc-info">
                                <div class="doc-icon">üìÑ</div>
                                <div>
                                    <div class="doc-name">${doc.fileName}</div>
                                    <div class="doc-date">üìÖ ${new Date(doc.createdAt).toLocaleDateString('vi-VN')}</div>
                                </div>
                            </div>
                            <div class="doc-actions">
                                <button class="btn btn-pink" onclick="selectDoc('${doc.documentId}', 'flashcards')" title="T·∫°o Flashcards">üé¥</button>
                                <button class="btn btn-purple" onclick="selectDoc('${doc.documentId}', 'quiz')" title="T·∫°o Quiz">‚ùì</button>
                                <button class="btn btn-blue" onclick="selectDoc('${doc.documentId}', 'chat')" title="Chat">üí¨</button>
                            </div>
                        </div>
                    `).join('');
                }

                // Update dropdowns
                const opts = documents.map(d => `<option value="${d.documentId}">${d.fileName}</option>`).join('');
                document.getElementById('flashcardDocSelect').innerHTML = '<option value="">-- Ch·ªçn t√†i li·ªáu --</option>' + opts;
                document.getElementById('quizDocSelect').innerHTML = '<option value="">-- Ch·ªçn t√†i li·ªáu --</option>' + opts;
                document.getElementById('chatDocSelect').innerHTML = '<option value="">-- Ch·ªçn t√†i li·ªáu --</option>' + opts;
                
                updateStats();
            } catch (error) {
                console.error(error);
            }
        }

        function selectDoc(docId, tab) {
            document.getElementById(`${tab === 'flashcards' ? 'flashcardDocSelect' : tab === 'quiz' ? 'quizDocSelect' : 'chatDocSelect'}`).value = docId;
            document.querySelector(`[data-tab="${tab}"]`).click();
        }

        // ========================================
        // FLASHCARDS
        // ========================================
        async function createFlashcards() {
            const docId = document.getElementById('flashcardDocSelect').value;
            const count = document.getElementById('flashcardCount').value;
            
            if (!docId) {
                showToast('‚ö†Ô∏è Vui l√≤ng ch·ªçn t√†i li·ªáu!', 'error');
                return;
            }

            try {
                showToast('‚ú® ƒêang t·∫°o flashcards...', 'info');
                const result = await apiCall(`/documents/${docId}/flashcards`, 'POST', { count: parseInt(count) });
                
                currentFlashcards = result.flashcards || [];
                currentFlashcardIndex = 0;
                isFlipped = false;
                
                showFlashcard();
                showToast(`‚úÖ ƒê√£ t·∫°o ${currentFlashcards.length} flashcards!`, 'success');
                updateStats();
            } catch (error) {
                showToast('‚ùå L·ªói: ' + error.message, 'error');
            }
        }

        function showFlashcard() {
            if (currentFlashcards.length === 0) return;
            
            const card = currentFlashcards[currentFlashcardIndex];
            const el = document.getElementById('currentFlashcard');
            const content = document.getElementById('flashcardContent');
            const badge = document.getElementById('flashcardBadge');
            
            if (isFlipped) {
                content.textContent = card.answer || card.back;
                badge.textContent = '‚úÖ Tr·∫£ l·ªùi';
                el.classList.add('flipped');
            } else {
                content.textContent = card.question || card.front;
                badge.textContent = '‚ùì C√¢u h·ªèi';
                el.classList.remove('flipped');
            }
            
            document.getElementById('cardCounter').textContent = `${currentFlashcardIndex + 1} / ${currentFlashcards.length}`;
        }

        function flipCard() {
            isFlipped = !isFlipped;
            showFlashcard();
        }

        function nextCard() {
            if (currentFlashcardIndex < currentFlashcards.length - 1) {
                currentFlashcardIndex++;
                isFlipped = false;
                showFlashcard();
            }
        }

        function prevCard() {
            if (currentFlashcardIndex > 0) {
                currentFlashcardIndex--;
                isFlipped = false;
                showFlashcard();
            }
        }

        // ========================================
        // QUIZ
        // ========================================
        async function createQuiz() {
            const docId = document.getElementById('quizDocSelect').value;
            const count = document.getElementById('quizCount').value;
            const difficulty = document.getElementById('quizDifficulty').value;
            
            if (!docId) {
                showToast('‚ö†Ô∏è Vui l√≤ng ch·ªçn t√†i li·ªáu!', 'error');
                return;
            }

            try {
                showToast('üéØ ƒêang t·∫°o quiz...', 'info');
                const result = await apiCall(`/documents/${docId}/quiz`, 'POST', { 
                    questionCount: parseInt(count),
                    difficulty 
                });
                
                currentQuiz = result.quiz || result;
                selectedAnswers = {};
                renderQuiz();
                showToast('‚úÖ ƒê√£ t·∫°o quiz!', 'success');
                updateStats();
            } catch (error) {
                showToast('‚ùå L·ªói: ' + error.message, 'error');
            }
        }

        function renderQuiz() {
            if (!currentQuiz?.questions) return;
            
            const area = document.getElementById('quizArea');
            area.innerHTML = currentQuiz.questions.map((q, qi) => {
                // Handle both array and object format for options
                let optionsArray = [];
                if (Array.isArray(q.options)) {
                    optionsArray = q.options;
                } else if (typeof q.options === 'object') {
                    // Convert object {A: '...', B: '...', C: '...', D: '...'} to array
                    optionsArray = ['A', 'B', 'C', 'D'].map(key => q.options[key]).filter(Boolean);
                }
                
                return `
                <div style="margin-bottom: 30px;">
                    <div class="quiz-question">
                        <span class="quiz-question-number">C√¢u ${qi + 1}</span>
                        ${q.question}
                    </div>
                    <div class="quiz-options">
                        ${optionsArray.map((opt, oi) => `
                            <div class="quiz-option" onclick="selectAnswer(${qi}, ${oi})" id="q${qi}o${oi}">
                                <div class="quiz-option-letter">${String.fromCharCode(65 + oi)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `}).join('');
            
            area.innerHTML += `<button class="btn btn-orange btn-block" onclick="submitQuiz()">üìù N·ªòP B√ÄI</button>`;
            document.getElementById('quizResult').style.display = 'none';
        }

        function selectAnswer(qi, oi) {
            document.querySelectorAll(`[id^="q${qi}o"]`).forEach(el => el.classList.remove('selected'));
            document.getElementById(`q${qi}o${oi}`).classList.add('selected');
            selectedAnswers[qi] = oi;
        }

        function submitQuiz() {
            if (!currentQuiz) return;
            
            let correct = 0;
            currentQuiz.questions.forEach((q, qi) => {
                const selected = selectedAnswers[qi];
                const correctIdx = q.correctAnswer ?? q.correct ?? 0;
                
                if (selected === correctIdx) {
                    correct++;
                    document.getElementById(`q${qi}o${selected}`)?.classList.add('correct');
                } else {
                    document.getElementById(`q${qi}o${selected}`)?.classList.add('wrong');
                    document.getElementById(`q${qi}o${correctIdx}`)?.classList.add('correct');
                }
            });
            
            const total = currentQuiz.questions.length;
            const percent = Math.round((correct / total) * 100);
            
            document.getElementById('quizResult').innerHTML = `
                <div class="quiz-result">
                    <div class="quiz-score">${correct}/${total}</div>
                    <div style="font-size: 18px; margin-top: 10px;">${percent >= 70 ? 'üéâ Xu·∫•t s·∫Øc!' : percent >= 50 ? 'üëç Kh√° t·ªët!' : 'üí™ C·ªë g·∫Øng th√™m!'}</div>
                    <div style="margin-top: 8px; color: #666;">ƒê·∫°t ${percent}% s·ªë c√¢u ƒë√∫ng</div>
                </div>
            `;
            document.getElementById('quizResult').style.display = 'block';
            
            showToast(`${percent >= 70 ? 'üéâ' : 'üìä'} B·∫°n ƒë·∫°t ${correct}/${total} ƒëi·ªÉm!`, percent >= 50 ? 'success' : 'error');
        }

        // ========================================
        // CHAT
        // ========================================
        async function sendChat() {
            const docId = document.getElementById('chatDocSelect').value;
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            
            if (!docId) {
                showToast('‚ö†Ô∏è Vui l√≤ng ch·ªçn t√†i li·ªáu!', 'error');
                return;
            }
            if (!msg) return;

            addChatMessage(msg, 'user');
            input.value = '';
            chatCount++;

            try {
                const result = await apiCall(`/documents/${docId}/chat`, 'POST', { question: msg });
                addChatMessage(result.answer || result.response, 'bot');
                chatCount++;
                updateStats();
            } catch (error) {
                addChatMessage('‚ùå Xin l·ªói, c√≥ l·ªói x·∫£y ra: ' + error.message, 'bot');
            }
        }

        function addChatMessage(text, type) {
            const el = document.getElementById('chatMessages');
            el.innerHTML += `
                <div class="chat-message ${type}">
                    <div class="chat-avatar">${type === 'user' ? 'üë§' : 'ü§ñ'}</div>
                    <div class="chat-bubble">${text}</div>
                </div>
            `;
            el.scrollTop = el.scrollHeight;
        }

        // ========================================
        // EXPLAIN
        // ========================================
        async function explainConcept() {
            const concept = document.getElementById('explainConcept').value;
            const level = document.getElementById('explainLevel').value;
            
            if (!concept) {
                showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p kh√°i ni·ªám!', 'error');
                return;
            }

            try {
                document.getElementById('explainOutput').innerHTML = '<div class="spinner"></div> ƒêang t·∫°o gi·∫£i th√≠ch...';
                showToast('üí° ƒêang x·ª≠ l√Ω...', 'info');
                
                const result = await apiCall('/explain', 'POST', { text: concept, level });
                document.getElementById('explainOutput').innerHTML = result.explanation || result.result;
                
                showToast('‚úÖ Ho√†n th√†nh!', 'success');
            } catch (error) {
                document.getElementById('explainOutput').innerHTML = '‚ùå L·ªói: ' + error.message;
                showToast('‚ùå L·ªói: ' + error.message, 'error');
            }
        }

        // ========================================
        // STATS
        // ========================================
        function updateStats() {
            document.getElementById('stat-docs').textContent = documents.length;
            document.getElementById('stat-flashcards').textContent = currentFlashcards.length;
            document.getElementById('stat-quizzes').textContent = currentQuiz?.questions?.length || 0;
            document.getElementById('stat-chats').textContent = chatCount;
        }

        // ========================================
        // FILE DRAG & DROP
        // ========================================
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.background = 'var(--yellow)'; });
        dropZone.addEventListener('dragleave', () => { dropZone.style.background = ''; });
        dropZone.addEventListener('drop', e => {
            e.preventDefault();
            dropZone.style.background = '';
            if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });

        // Store selected file for upload
        let selectedFile = null;
        
        function handleFile(file) {
            const ext = file.name.toLowerCase().split('.').pop();
            const supportedTypes = ['pdf', 'txt', 'docx', 'doc'];
            
            if (!supportedTypes.includes(ext)) {
                showToast('‚ùå Ch·ªâ h·ªó tr·ª£ PDF, DOCX, TXT!', 'error');
                return;
            }
            
            selectedFile = file;
            document.getElementById('docName').value = file.name.replace(/\.[^/.]+$/, '');
            
            // For TXT files, show content preview
            if (ext === 'txt') {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('directContent').value = e.target.result;
                    showToast('üìÑ File TXT ƒë√£ ƒë∆∞·ª£c t·∫£i!', 'success');
                };
                reader.readAsText(file);
            } else {
                // For PDF/DOCX, just show file info
                document.getElementById('directContent').value = `üìé File ƒë√£ ch·ªçn: ${file.name}\nüì¶ K√≠ch th∆∞·ªõc: ${(file.size / 1024).toFixed(2)} KB\nüìÇ Lo·∫°i: ${ext.toUpperCase()}\n\n(N·ªôi dung s·∫Ω ƒë∆∞·ª£c tr√≠ch xu·∫•t khi t·∫£i l√™n)`;
                showToast(`üìÑ File ${ext.toUpperCase()} ƒë√£ ƒë∆∞·ª£c ch·ªçn!`, 'success');
            }
        }

        // ========================================
        // INIT
        // ========================================
        // Check authentication on page load
        if (checkAuth()) {
            loadDocuments();
        }
    </script>
</body>
</html>
